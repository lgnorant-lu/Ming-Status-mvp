# 宏观计划

本文档基于**项目发展蓝图V2.0**，概述了 `桌宠AI助理平台` 项目的高级计划、主要里程碑和战略目标。

## 🎯 项目核心定位
**桌宠AI助理平台** - 一个以"桌宠"为情感与交互核心的、高度模块化和可扩展的个人桌面AI助理平台。

**设计哲学**: "是桌宠，更是应用 (A Pet, and an App)" - 桌宠为平台注入生命和情感，强大的功能模块赋予平台真正的实用价值。

## 🏗️ 核心技术架构
- **架构范式**: "桌宠-总线"插件式架构 + "包驱动Monorepo"
- **技术栈**: Flutter + RxDart + get_it + go_router + Drift
- **安全模型**: "城堡防御模型"(多层纵深防御)
- **双端交互范式**:
  - **PC端**: "空间化OS (Spatial OS)"模式 - 浮窗卡片形式
  - **移动端**: "沉浸式标准应用"模式 - 全屏原生体验

---

## 🎉 Phase 0: 奠基与MVP ✅ (已完成)

- **目标**: 建立一个健壮且可扩展的"桌宠-总线"架构，为后续功能开发奠定坚实基础。
- **状态**: `[已完成]` ✅ 2025-01-27
- **关键交付物**:
  - ✅ 基于 RxDart 的核心事件总线系统 (`EventBus`)
  - ✅ 为未来插件设计的清晰模块接口 (`PetModuleInterface`)
  - ✅ 基于 `ChangeNotifier` 的中央状态管理核心 (`PetCore`)
  - ✅ 一个可工作的"打卡"模块，完整验证了端到端的数据流
  - ✅ 符合 v6 协议的完整项目结构和文档
  - ✅ 通过所有代码质量检查和测试验证
- **技术验证结果**:
  - ✅ 事件流完整性: UI交互 → 事件发布 → 订阅处理 → 状态更新 → UI响应
  - ✅ 模块化架构: 模块注册、初始化、启动流程正常工作
  - ✅ 依赖管理: get_it服务定位器和RxDart事件流集成成功
  - ✅ 测试覆盖: 核心功能测试通过，linter检查无问题

## 🏗️ Phase 1: 平台骨架构建 ✅ (已完成)

- **目标**: 基于Phase 0验证的架构，构建可承载所有功能模块的应用主框架，建立完整的技术基础设施。
- **状态**: `[已完成]` ✅ 2025-06-25
- **重大成就**: 
  - 💥 **内存崩溃问题彻底解决**: 修复了集成测试中的StreamController泄漏和无限递归问题
  - 🧪 **测试基础设施建立**: 单元测试+集成测试，10个测试用例100%通过
  - 🏗️ **企业级架构**: 混合架构(事件驱动+依赖注入)完整实现
- **关键交付物**:
  - ✅ **Part A-B-C-D**: 依赖管理、核心服务架构、安全基础、UI框架 (Steps 1-15)
    - go_router声明式路由、Repository模式数据层、模块管理服务
    - JWT认证、加密服务、API客户端安全栈
    - Material Design 3主题、响应式布局、导航系统、页面容器
  - ✅ **Part E**: 模块占位符系统 (Steps 16-18)
    - NotesHub事务中心、Workshop创意工坊、PunchIn打卡系统重构
    - 完整的模块生命周期管理和事件驱动通信
  - ✅ **Part F**: 服务集成与启动 (Steps 19-21)
    - ServiceLocator依赖注入、AppBootstrap企业级启动器、AppConfig配置管理
  - ✅ **Part G**: 测试与文档 (Steps 22-23)
    - 单元测试(3个核心服务)、集成测试(10个端到端用例)、13个API文档体系

## 🎨 Phase 1.5: 架构升级与i18n集成 ✅ (已完成)

- **目标**: 集中进行架构升级与基础设施建设，实现包驱动模块化架构和全面国际化支持。
- **状态**: `[已完成]` ✅ 2025-06-26
- **关键交付物**:
  - ✅ **源码架构升级**: "包驱动Monorepo"架构，7个独立包物理隔离
  - ✅ **国际化集成**: 完整i18n体系，94个键值对双语支持
  - ✅ **核心基础设施**: 4大企业级服务框架(Logging/ErrorHandling/Performance/Theme)
  - ✅ **质量保障**: 零错误零警告代码质量，完整API文档体系

## 🔧 Phase 1.6: Finalization ✅ (已完成)

- **目标**: 消除所有已知TODO，实现企业级生产就绪状态，为Phase 2.0奠定高质量基础。
- **状态**: `[已完成]` ✅ 2025-06-27
- **重大成就**:
  - ✅ **NavigationDrawer完整本地化**: 12个字段，真正双语支持
  - ✅ **LoggingService文件写入功能**: 异步IO、错误处理、文件轮转
  - ✅ **技术债务清理**: Issues.md追踪体系建立，P1.6问题全部解决
  - ✅ **诚实评估**: 完成度从声称A+(95%)修正为实际B(75%)
  - ✅ **Phase 2.0详细规划**: 基于功能缺陷分析的完整实施方案

---

## 🚀 Phase 2.0: 平台UI框架与核心体验构建 (当前目标)

### 📋 **核心目标** (基于项目蓝图V2.0)
构建"双端自适应UI框架"，实现差异化的交互体验：
- **PC端**: "空间化OS (Spatial OS)"模式 - 桌宠作为智能助手，功能模块以浮窗卡片形式存在
- **移动端**: "沉浸式标准应用"模式 - 遵循Material Design的全屏原生体验

### 🎯 **具体交付物**
1. **构建"手机OS"风格的桌面UI (SpatialOsShell)**
2. **构建"沉浸式标准应用"的移动UI (StandardAppShell)**  
3. **将所有规划中的模块实现为可点击的"App图标"**
4. **实现点击图标后，以"浮窗卡片"或全屏页面形式打开模块的UI占位符**

### 🛠️ **实施策略**
- **"先具体后抽象"** + **"移动端先行验证逻辑"**
- **4个Sprint分阶段执行**，每个Sprint都有用户验证检查点

### 📋 **详细Sprint规划**

#### **Sprint 2.0a: 移动端验证与基础奠基** (1周)
- [ ] 核心服务接口定义和最简实现
- [ ] ui_framework中ThemeService接口建立  
- [ ] 实现StandardAppShell（移动端外壳），加载模块占位符UI
- [ ] 修改app_router，Android平台默认加载StandardAppShell
- [ ] 建立技术债务信用系统和追踪机制
- [ ] **用户验证点**: Android设备导航和模块切换体验验证

#### **Sprint 2.0b: 空间化桌面核心实现** (2周)
- [ ] 创建desktop_environment新包
- [ ] 实现SpatialOsShell基础静态布局和AppDock
- [ ] 实现WindowManager类和FloatingWindow组件，基础拖拽功能
- [ ] AppDock点击事件连接WindowManager，实现浮窗打开
- [ ] 定义性能基准线(窗口拖拽≥60fps，模块启动≤300ms)
- [ ] **用户验证点**: Windows基础图标启动、浮窗拖拽体验验证

#### **Sprint 2.0c: 交互深化与服务集成** (1周)  
- [ ] FloatingWindow边缘缩放和最小化功能
- [ ] WindowManager智能吸附或网格对齐逻辑
- [ ] 状态管理路径明确(Local State → EventBus → Sync Interface)
- [ ] 预留前瞻性接口(热插拔、性能调度器)
- [ ] **用户验证点**: PC端窗口交互完整性和流畅性验证

#### **Sprint 2.0d: 质量保障与开发者工具** (1周)
- [ ] 分层测试策略执行，覆盖率≥80%
- [ ] DevPanel MVP开发(实时显示FloatingWindow状态)
- [ ] 技术债务审查和偿还计划
- [ ] 更新项目和API文档
- [ ] **用户验证点**: Alpha Test完整体验和反馈收集

### 🎯 **成功标准**
- **性能**: 窗口拖拽≥60fps，模块启动≤300ms，浮窗内存≤50MB
- **质量**: 核心服务测试覆盖≥80%，代码零错误零警告
- **体验**: 移动端导航≥4.0分，PC端交互≥3.5分，整体满意度≥4.2分

### **状态**: `[ready-to-start]` - Phase 1.6基础设施完全就绪，可立即开始Sprint 2.0a

---

## 🎯 Phase 2.1: 核心功能完善与持久化 (规划中)

### 📋 **核心目标**  
基于Phase 2.0的UI框架，深化核心功能实现和数据持久化升级

### 🎯 **主要交付物**
- **Drift数据库集成**: 替换InMemoryRepository，实现真正的数据持久化
- **事务管理中心CRUD完善**: 实现完整的编辑功能，解决P2.0-001关键缺陷
- **创意工坊编辑功能**: 移除"功能待实现"占位符，解决P2.0-002关键缺陷
- **数据架构升级**: 向后兼容的数据格式升级，版本控制机制

### 📊 **质量目标**
- 数据可靠性从40%提升到95%
- CRUD操作完整性100%
- 业务模块功能从60%提升到90%

---

## 🎨 Phase 2.2: 系统应用与体验增强 (规划中)

### 📋 **核心目标**
系统级应用功能填充和用户体验精修

### 🎯 **主要交付物**
- **设置应用功能**: 主题切换、语言设置、模块管理核心功能
- **健康系统插件**: 久坐提醒等健康关怀功能实现
- **UI/UX精修**: Layer 1&2动效打磨，交互体验优化
- **富文本支持**: Markdown编辑器集成，内容编辑能力增强

---

## 🌟 Phase 3.0: 生态系统启动 (远期规划)

### 📋 **核心目标**
构建完整的应用生态和智能化能力

### 🎯 **主要交付物**
- **创意工坊核心功能**: 皮肤管理、插件管理、应用商店
- **PC端工作区**: 布局保存/恢复功能，多任务工作流支持
- **桌宠动画系统**: 引入Rive，复杂行为动画和状态机
- **插件开发框架**: 第三方开发者工具和脚手架

---

## 🤖 Phase 4.0+: 后端与智能服务 (远期规划)

### 📋 **核心目标**
后端服务建设和AI能力集成

### 🎯 **主要交付物**
- **后端架构**: FastAPI + Docker + Kubernetes微服务
- **用户系统**: 账号管理、数据同步、云端备份
- **AI模块集成**: RAG知识库、OCR功能、自动化工作流
- **开发者生态**: 插件市场、开发者工具、社区建设

---

## 📊 应用生态规划

### 核心系统应用 (不可卸载)
- **设置 (Settings)**: 平台控制中心，外观/模块管理/语言设置
- **文件系统 (Virtual File System)**: IPersistenceRepository可视化前端
- **创意工坊 (Creative Workshop)**: 平台"应用商店"和"主题商店"

### 初始功能应用 (理论上可卸载)  
- **事务管理中心 (Notes & To-do Hub)**: 核心价值模块，笔记与待办
- **健康系统 (Health System)**: 久坐提醒等健康关怀功能
- **打卡模块 (Punch-in Module)**: 轻量级习惯追踪工具

### 长期生态规划
- **开发者工具**: 插件开发脚手架，API文档智能问答
- **AI集成**: RAG文档助手、OCR模块、n8n自动化
- **第三方生态**: 插件权限模型、应用审核机制

---

**注释**: 基于项目发展蓝图V2.0，各阶段的具体范围和时间线将根据实际开发进度和用户反馈动态调整。Phase 1.6的成功完成为后续开发奠定了坚实的技术基础和高质量的项目管理标准。 