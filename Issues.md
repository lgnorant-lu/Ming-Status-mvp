# 问题追踪文档 (Issues Tracking)

基于**项目发展蓝图V2.0**进行问题分类和优先级管理。

## 🎯 **已解决问题** (Resolved Issues)

### `[RESOLVED-P1.6-001]` 语言切换功能误删 `[critical]` `[closed]`
- **发现时间**: 2025-06-27 Phase 1.6 (用户报告)
- **位置**: `packages/ui_framework/lib/shell/main_shell.dart` (误删`_showLanguageDialog`)
- **问题描述**: Step3重构时误删语言切换功能，用户无法切换应用界面语言，i18n核心功能缺失
- **解决方案**: 在AdaptiveNavigationDrawer中恢复语言切换功能，添加Language按钮和双语对话框
- **解决状态**: ✅ **已完成** (2025-06-27紧急修复)
- **相关提交**: Phase 1.6 emergency language switching fix

### `[RESOLVED-P1.6-002]` NavigationDrawer本地化缺失 `[critical]` `[closed]`
- **发现时间**: 2025-06-27 Phase 1.6
- **位置**: `packages/ui_framework/lib/shell/navigation_drawer.dart` 
- **问题描述**: 7个TODO标记的硬编码中文字符串破坏i18n体系完整性
- **解决方案**: 扩展MainShellLocalizations参数传递模式，与MainShell保持架构一致性
- **解决状态**: ✅ **已完成** (2025-06-27)
- **相关提交**: Phase 1.6 finalization

### `[RESOLVED-P1.6-003]` LoggingService文件写入功能不完整 `[high]` `[closed]`
- **发现时间**: 2025-06-27 Phase 1.6  
- **位置**: `packages/core_services/lib/services/logging_service.dart`
- **问题描述**: FileLogOutput类缺少实际文件操作实现，只有占位符TODO
- **解决方案**: 实现完整的异步文件操作：懒加载初始化、IOSink管理、错误处理、文件轮转
- **解决状态**: ✅ **已完成** (2025-06-27)
- **相关提交**: Phase 1.6 finalization

---

## 🚨 **当前开放问题** (Open Issues)

### Phase 2.0相关问题 (双端UI框架构建)

### Sprint 2.0b 用户反馈优化点 (UI/UX改进)

### `[OPEN-P2.0-UX-001]` 窗口边界约束优化 `[medium]` `[enhancement]`
- **发现时间**: 2025-06-27 Sprint 2.0b用户体验反馈
- **位置**: `packages/desktop_environment/lib/floating_window.dart`
- **问题描述**: 窗口拖拽时边界处理需要改进，可能存在窗口超出屏幕边界的情况
- **影响范围**: 🟡 **用户体验，窗口可能被拖拽到无法操作的位置**
- **优先级**: `[medium]` - Sprint 2.0c考虑实现
- **预期解决方案**: 实现窗口边界检测和自动约束逻辑
- **用户反馈**: "边界尚未处理好"

### `[OPEN-P2.0-UX-002]` 窗口自定义调整大小功能缺失 `[medium]` `[feature]`
- **发现时间**: 2025-06-27 Sprint 2.0b用户体验反馈
- **位置**: `packages/desktop_environment/lib/floating_window.dart`
- **问题描述**: 目前窗口大小固定，用户无法通过拖拽边角调整窗口大小
- **影响范围**: 🟡 **用户体验，窗口大小无法适应内容需要**
- **优先级**: `[medium]` - Sprint 2.0c边缘缩放功能实现
- **预期解决方案**: 实现窗口边缘和角落的调整大小手柄
- **用户反馈**: "窗口自定义大小尚无"

### `[OPEN-P2.0-UX-003]` 窗口状态记录逻辑设计决策 `[low]` `[behavior]`
- **发现时间**: 2025-06-27 Sprint 2.0b用户体验反馈
- **位置**: `packages/desktop_environment/lib/window_manager.dart`
- **问题描述**: 最大化→最小化→恢复时，记录的是默认大小而非原始大小。用户认为这可能是有用特性但需要设计规范
- **影响范围**: 🟢 **用户体验，状态恢复行为可能不符合预期，但可能是有价值的特性**
- **优先级**: `[low]` - 行为设计决策，后续UI/UX改进考虑
- **预期解决方案**: 
  - 选项A: 修复为严格恢复原始大小
  - 选项B: 设计为有意的特性，提供多级状态记录
- **用户反馈**: "有点使用价值，这个特性，但需挖掘；以及进阶的设计"

### `[OPEN-P2.0-UX-004]` 最小化行为语义优化 `[low]` `[behavior]`
- **发现时间**: 2025-06-27 Sprint 2.0b用户体验反馈
- **位置**: `packages/desktop_environment/lib/spatial_os_shell.dart`
- **问题描述**: 当前所有窗口最小化为统一行为，用户反馈点击恢复时的交互逻辑需要优化
- **影响范围**: 🟢 **用户体验，最小化/恢复的交互逻辑**
- **优先级**: `[low]` - 交互设计优化，后续UI/UX改进考虑
- **预期解决方案**: 设计更精细的最小化行为和任务栏交互
- **用户反馈**: "窗口是所有都最小化，点击一个的时候"

### `[OPEN-P2.0-UX-005]` 任务栏自动隐藏功能 `[high]` `[enhancement]`
- **发现时间**: 2025-06-27 Sprint 2.0c完成后用户建议
- **位置**: `packages/desktop_environment/lib/spatial_os_shell.dart`, `packages/desktop_environment/lib/app_dock.dart`
- **问题描述**: 参考Windows任务栏设计，添加任务栏隐藏开关功能，提供更大的窗口交互空间
- **影响范围**: 🟡 **用户体验增强，提供60px额外显示空间，沉浸式体验优化**
- **优先级**: `[high]` - 优秀的UX增强功能，用户主动提出
- **预期解决方案**: 
  - AppDock添加autoHide状态管理
  - 底部边缘鼠标检测机制(类似窗口resize检测)
  - 滑入/滑出动画过渡效果
  - 隐藏状态下窗口约束调整(可用完整屏幕高度)
  - 设置界面添加自动隐藏开关选项
- **用户反馈**: "任务栏的隐藏设计开关.隐藏的话,就多一块交互范围更简洁了"
- **技术要点**: 
  - 鼠标hover底部边缘检测
  - 动画状态管理(显示/隐藏/过渡中)
  - 窗口边界约束动态调整
  - 用户偏好设置持久化
- **实现优先级**: Phase 2.0后期或Phase 2.1前期，避免与当前大改冲突

### `[OPEN-P2.0-001]` 双端UI框架架构设计缺失 `[critical]` `[open]`
- **发现时间**: 2025-06-27 项目蓝图V2.0制定
- **位置**: 项目架构层面
- **问题描述**: 
  - 缺少"空间化OS"(PC端)和"沉浸式标准应用"(移动端)的具体UI框架设计
  - 没有SpatialOsShell和StandardAppShell的实现基础
  - 缺少WindowManager、FloatingWindow、AppDock等核心组件
  - 没有双端交互范式的技术实现方案
- **影响范围**: 🔴 **Phase 2.0核心目标无法启动**
- **优先级**: `[critical]` - Phase 2.0第一优先级
- **预期解决方案**: 
  - Sprint 2.0a: 实现StandardAppShell移动端框架
  - Sprint 2.0b: 实现SpatialOsShell桌面端框架  
  - Sprint 2.0c: 完善窗口管理和交互逻辑
  - Sprint 2.0d: 性能优化和开发者工具
- **技术债务影响**: 阻碍项目向"桌宠AI助理平台"的战略转型
- **当前状态**: 🟡 **Sprint 2.0a进行中** - StandardAppShell基础架构已创建

### `[OPEN-P2.0-002]` 性能基准线定义缺失 `[high]` `[open]`
- **发现时间**: 2025-06-27 Phase 2.0规划
- **位置**: 整体性能管理
- **问题描述**:
  - 缺少明确的性能基准线定义(窗口拖拽帧率、模块启动时间等)
  - 没有性能监控和测试机制
  - 缺少浮窗内存使用限制
- **影响范围**: 🟡 **影响双端UI框架的用户体验质量**
- **优先级**: `[high]` - Phase 2.0质量保障
- **预期解决方案**:
  - 定义性能基准: 窗口拖拽≥60fps，模块启动≤300ms，浮窗内存≤50MB
  - 实现性能监控工具和测试套件
  - 建立性能回归测试机制
- **技术选型建议**: 集成Flutter Performance工具链

### `[OPEN-P2.0-003]` 用户验证闭环机制缺失 `[medium]` `[open]`
- **发现时间**: 2025-06-27 Phase 2.0规划
- **位置**: 项目管理流程
- **问题描述**:
  - 每个Sprint缺少用户验证检查点的具体实施机制
  - 没有用户反馈收集和处理流程
  - 缺少体验评分和满意度测量工具
- **影响范围**: 🟡 **影响Phase 2.0的迭代质量和用户体验验证**
- **优先级**: `[medium]` - Phase 2.0流程保障
- **预期解决方案**:
  - 建立用户验证检查点标准流程
  - 设计体验评分问卷和反馈收集机制
  - 制定基于用户反馈的迭代调整策略

---

### Phase 2.1相关问题 (核心功能完善与持久化) 

### `[OPEN-P2.1-001]` 事务中心编辑功能系统性缺失 `[critical]` `[open]`
- **发现时间**: 2025-06-27 Phase 1.6功能核对
- **位置**: `packages/notes_hub/lib/notes_hub_widget.dart`
- **问题描述**: 
  - 只有创建(Create)和删除(Delete)功能
  - 详情对话框无编辑按钮，无法修改已创建的事务
  - CRUD操作不完整，缺少Update操作
  - 用户体验不完整，无法满足基本业务需求
- **影响范围**: 🔴 **用户无法修改任何已创建的笔记、待办、项目等事务**
- **优先级**: `[critical]` - Phase 2.1第一优先级
- **预期解决方案**: 
  - 实现完整的编辑对话框
  - 添加更新逻辑和状态管理  
  - 支持标题、内容、优先级、截止日期的修改
- **技术债务影响**: 阻碍应用成为完整的生产力工具

### `[OPEN-P2.1-002]` 创意工坊编辑功能占位符问题 `[critical]` `[open]`
- **发现时间**: 2025-06-27 Phase 1.6功能核对
- **位置**: `packages/workshop/lib/workshop_widget.dart`
- **问题描述**:
  - 编辑按钮点击显示"编辑功能待实现"消息 (`editFunctionTodo: '编辑功能待实现'`)
  - 用户体验极差，功能声称完成但实际未实现
  - CRUD操作不完整，只有创建和删除
- **影响范围**: 🔴 **用户无法修改任何创意工坊项目，严重影响创作流程**
- **优先级**: `[critical]` - Phase 2.1第一优先级  
- **预期解决方案**:
  - 移除"编辑功能待实现"占位符
  - 实现真实的编辑对话框和更新逻辑
  - 支持8种创意类型的完整编辑功能
- **技术债务影响**: 破坏用户对产品的信任度

### `[OPEN-P2.1-003]` 数据持久化架构缺失 `[high]` `[open]`
- **发现时间**: 2025-06-27 Phase 1.6功能核对
- **位置**: 所有业务模块 (`notes_hub`, `workshop`, `punch_in`)
- **问题描述**:
  - 所有业务数据仅存储在内存中 (`InMemoryRepository`)
  - 应用重启后数据全部丢失
  - 无法满足生产环境的数据可靠性需求
- **影响范围**: 🔴 **无法作为实际生产力工具使用，数据丢失风险极高**
- **优先级**: `[high]` - Phase 2.1核心目标
- **预期解决方案**:
  - 实现`IPersistenceRepository`的Drift版本
  - 数据迁移策略：从内存存储升级到SQLite
  - 版本控制和数据备份机制
- **技术选型建议**: Drift (SQLite for Flutter)

### `[OPEN-P2.1-004]` 富文本支持缺失 `[medium]` `[open]`
- **发现时间**: 2025-06-27 Phase 1.6功能核对
- **位置**: `packages/notes_hub/lib/notes_hub_widget.dart`
- **问题描述**:
  - 事务中心只支持纯文本输入 (title + content)
  - 无Markdown/MDX支持，无法进行格式化文本编辑
  - 无法插入图片、链接、代码块等富媒体内容
- **影响范围**: 🟡 **限制了笔记和文档的表现力，影响高级用户体验**
- **优先级**: `[medium]` - Phase 2.1增强目标
- **预期解决方案**:
  - 集成Markdown编辑器组件
  - 语法高亮和实时预览
  - 图片、链接、代码块支持
- **技术选型建议**: `flutter_markdown` + `markdown_editable_textinput`

---

### Phase 2.2+相关问题 (系统应用与体验增强)

### `[OPEN-P2.2-001]` 业务模块高级功能缺失 `[low]` `[open]`
- **发现时间**: 2025-06-27 Phase 1.6功能核对
- **位置**: 所有业务模块
- **问题描述**:
  - 缺少搜索、过滤、排序功能
  - 无批量操作能力
  - 缺少导入/导出功能
  - 无数据统计和分析功能
- **影响范围**: 🟡 **限制了应用在大量数据场景下的使用效率**
- **优先级**: `[low]` - Phase 2.2可选目标
- **预期解决方案**: 根据Phase 2.1开发进度和用户反馈确定实现优先级

---

## 📊 **技术债务信用系统追踪** (Technical Debt Tracker)

*Phase 2.0 Sprint 2.0a引入 - 基于[设计原则文档](docs/design_principles.md#技术债务信用系统)*

### 当前债务概览
- **债务总量**: 7个DEBT标记 (信用额度: ≤50个)
- **高利息债务**: 1个 DEBT-HIGH
- **中等利息债务**: 3个 DEBT-MED  
- **低利息债务**: 3个 DEBT-LOW
- **临界债务**: 0个 DEBT-CRITICAL ✅

### 活跃技术债务清单

#### `[DEBT-ARCH-001]` WindowManager需要抽象接口 `[MED]` `[Sprint 2.0c]`
- **位置**: `packages/desktop_environment/lib/window_manager.dart`
- **债务类型**: 架构设计债务
- **描述**: 当前为具体类实现，未来需要抽象接口支持多种窗口管理策略
- **利息影响**: 影响桌面端扩展能力和测试覆盖
- **偿还计划**: Sprint 2.0c完成接口抽象

#### `[DEBT-PERF-002]` 浮窗拖拽帧率优化 `[HIGH]` `[Sprint 2.0d]`
- **位置**: `packages/desktop_environment/lib/floating_window.dart`
- **债务类型**: 性能优化债务
- **描述**: 当前拖拽实现可能导致帧率下降，需要优化渲染性能
- **利息影响**: 直接影响用户体验，违反60fps性能基准
- **偿还计划**: Sprint 2.0d立即处理

#### `[DEBT-UX-003]` 模块加载动画缺失 `[LOW]` `[Phase 2.1]`
- **位置**: `packages/ui_framework/lib/shell/app_shell.dart`
- **债务类型**: 用户体验债务
- **描述**: 模块切换时缺少平滑过渡动画，体验略显生硬
- **利息影响**: 影响整体用户体验流畅度
- **偿还计划**: Phase 2.1视情况处理

#### `[DEBT-TEST-004]` StandardAppShell缺少集成测试 `[MED]` `[Sprint 2.0d]`
- **位置**: `packages/ui_framework/test/shell/`
- **债务类型**: 测试覆盖债务
- **描述**: 新实现的StandardAppShell缺少完整的Widget测试覆盖
- **利息影响**: 影响代码质量和重构信心
- **偿还计划**: Sprint 2.0d测试套件完善

#### `[DEBT-I18N-005]` 路由模块本地化硬编码 `[LOW]` `[Phase 2.1]`
- **位置**: `packages/app_routing/lib/app_router.dart`  
- **债务类型**: 国际化债务
- **描述**: 路由模块中存在硬编码的中文字符串，未集成i18n系统
- **利息影响**: 破坏国际化体系完整性
- **偿还计划**: Phase 2.1国际化完善时处理

#### `[DEBT-I18N-006]` Phase 2.0 i18n系统临时简化 `[MED]` `[Phase 2.1]`
- **位置**: `packages/app_routing/lib/app_router.dart`, `main.dart`
- **债务类型**: 国际化债务
- **描述**: Phase 2.0为专注双端UI框架，临时移除了动态本地化系统(_LocalizedPetApp类)，改为硬编码中文字符串
- **利息影响**: 失去多语言切换能力，影响国际用户体验
- **偿还计划**: Phase 2.1重新集成完整i18n系统，恢复动态语言切换功能
- **技术方案**: 重新设计AppRouter的本地化集成方式，支持ShellRoute + i18n组合

#### `[DEBT-UX-007]` 设置页面导航功能缺失 `[LOW]` `[Phase 2.1]`
- **位置**: `packages/ui_framework/lib/shell/app_shell.dart:299`
- **债务类型**: 用户体验债务
- **描述**: StandardAppShell的NavigationDrawer中设置按钮点击事件只有TODO注释，未实现导航功能
- **利息影响**: 用户无法访问设置页面，影响应用配置和个性化体验
- **偿还计划**: Phase 2.1实现设置页面和导航功能
- **技术方案**: 创建设置页面路由，集成用户偏好设置、主题切换、语言选择等功能

### 债务趋势分析
- **Sprint 2.0a新增**: 7个债务 (含1个Phase 2.0临时简化项，1个设置导航缺失)
- **债务增长率**: N/A (基准建立)
- **偿还计划覆盖率**: 100% (所有债务都有明确偿还计划)
- **信用额度使用率**: 14% (7/50) ✅ 安全范围

### 偿还优先级排序
1. **`[DEBT-PERF-002]`** - 性能关键，Sprint 2.0d立即处理
2. **`[DEBT-ARCH-001]`** - 架构基础，Sprint 2.0c按计划处理  
3. **`[DEBT-TEST-004]`** - 质量保障，Sprint 2.0d同步处理
4. **`[DEBT-I18N-006]`** - 功能完整性，Phase 2.1优先恢复
5. **`[DEBT-UX-003]`** - 体验优化，Phase 2.1考虑
6. **`[DEBT-I18N-005]`** - 完整性保障，Phase 2.1处理
7. **`[DEBT-UX-007]`** - 设置导航，Phase 2.1处理

---

## 📊 **问题统计摘要** (Issue Statistics)

### Phase 1.6 已解决
- **总计**: 3个问题
- **关键**: 3个 (语言切换功能恢复、NavigationDrawer本地化、LoggingService文件写入)
- **解决率**: 100%

### Phase 2.0 当前开放 (双端UI框架构建)
- **总计**: 3个问题
- **关键**: 1个 (双端UI框架架构设计)
- **高优**: 1个 (性能基准线定义)
- **中优**: 1个 (用户验证闭环机制)

### Phase 2.1 待解决 (核心功能完善与持久化)
- **总计**: 4个问题
- **关键**: 2个 (编辑功能缺失)
- **高优**: 1个 (数据持久化)
- **中优**: 1个 (富文本支持)

### Phase 2.2+ 远期规划
- **总计**: 1个问题
- **低优**: 1个 (高级业务功能)

### 技术债务统计 (新增)
- **活跃债务**: 7个标记
- **高利息**: 1个 (性能优化)
- **中等利息**: 3个 (架构+测试+i18n)
- **低利息**: 3个 (UX+i18n+导航)
- **信用额度使用**: 14% ✅

### 整体技术债务评估 (基于项目蓝图V2.0)
- **架构基础**: ✅ Excellent (100%) 
- **基础设施**: ✅ 已清理 (100%)
- **双端UI框架**: 🟡 **Phase 2.0核心目标** (30% → 目标100%)
- **业务功能**: 🟡 **Phase 2.1核心目标** (60% → 目标95%+)
- **数据可靠性**: 🟡 **Phase 2.1核心目标** (40% → 目标95%+)
- **技术债务管理**: 🟢 **已建立信用系统** (10%使用率，健康状态)

---

## 🎯 **阶段性行动建议** (Recommendations by Phase)

### Phase 2.0优先级 (双端UI框架构建)
1. **解决P2.0-001**: 设计和实现双端UI框架架构
2. **解决P2.0-002**: 建立性能基准线和监控机制
3. **解决P2.0-003**: 建立用户验证闭环流程
4. **债务管理**: 控制新增债务，按计划偿还DEBT-PERF-002

### Phase 2.1优先级 (核心功能完善与持久化)  
1. **解决P2.1-001和P2.1-002**: 实现完整CRUD操作
2. **解决P2.1-003**: 数据持久化升级(Drift集成)
3. **债务偿还-I18N**: 优先处理DEBT-I18N-006，恢复完整国际化系统
4. **解决P2.1-004**: 富文本支持增强
5. **债务偿还-其他**: 处理DEBT-UX-003和DEBT-I18N-005

### Phase 2.2+优先级 (系统应用与体验增强)
1. **解决P2.2-001**: 高级业务功能和用户体验优化
2. **债务清理**: 确保债务总量控制在信用额度20%以内

### 总体成功标准
- **Phase 2.0**: 双端UI框架完全实现，性能达标，用户体验验证通过，债务控制在15%以内
- **Phase 2.1**: CRUD完整性100%，数据可靠性95%+，无"功能待实现"占位符，债务偿还率≥80%
- **Phase 2.2+**: 用户满意度4.5分+，功能完整性95%+，整体评级A+(90%+)，债务清零

---

*最后更新: 2025-06-27 基于项目发展蓝图V2.0 + 技术债务信用系统建立*
*下次更新: Phase 2.0 Sprint 2.0a完成时*
